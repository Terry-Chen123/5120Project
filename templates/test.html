{% extends 'base.html' %}
{% block mapstyle %}
    <style>
	body { margin: 0; padding: 0; }
	#map {
        position: relative;
        top: 0;
        bottom: 0;
        width: 100%;
        height:100%;
    }
</style>
{% endblock %}
{% block mainbody %}

<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.2.0/mapbox-gl-geocoder.min.js'></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"  type="text/css"  />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css"/>
<div id="map"></div>

<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoidGVycnljYXJyeXUiLCJhIjoiY2syNXFvYmd4MDg2bjNidGw1YnlsbndhayJ9.TGdaiRtA3NWwce3jDYrR1g';
    var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [12.550343, 55.665957],
    zoom: 8
    });

    var marker = new mapboxgl.Marker()
    .setLngLat([12.550343, 55.665957])
    .addTo(map);

     var geocoder = new MapboxGeocoder({ // Initialize the geocoder
          accessToken: mapboxgl.accessToken, // Set the access token
          mapboxgl: mapboxgl, // Set the mapbox-gl instance
          marker: false, // Do not use the default marker style
          placeholder: 'Search in Melbourne', // Placeholder text for the search bar
          bbox: [140.6, -39.3, 150.3, -33.8], // Boundary for Berkeley
          proximity: {
            longitude: 144.946457,
            latitude: -37.840935
          } // Coordinates of Melbourne
        });
        map.addControl(geocoder);

        //zoom in and out function
        map.addControl(new mapboxgl.NavigationControl());

        // locate yourself.
        map.addControl(
            new mapboxgl.GeolocateControl({
            positionOptions: {
            enableHighAccuracy: true
            },
            trackUserLocation: true
            })
        );;

        //direction
        map.addControl(
        new MapboxDirections({
        accessToken: mapboxgl.accessToken
        }),
        'top-left'
        );
    </script>
{% endblock %}
<div id='map' ></div>

        <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoidGVycnljYXJyeXUiLCJhIjoiY2syNXFvYmd4MDg2bjNidGw1YnlsbndhayJ9.TGdaiRtA3NWwce3jDYrR1g';
        var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [144.946457,-37.840935],
        zoom: 10
        });
        //add a new marker on map
        var new_lat = {{ hospital.latitude }}
        var new_long = {{ hospital.longitude }}
        var new_name = {{ hospital.postcode }}

        //offset: the distance between marker and text
        var popup = new mapboxgl.Popup({offset: 50})
        .setText(new_name);
        var marker_hospital = new mapboxgl.Marker()
        .setLngLat([new_long,new_lat])
        .addTo(map)
        .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
        .setHTML('<h3>' + marker.properties.title + '</h3><p>' + {{ hospital.postcode  }}+ '</p>'));

        //search function
        var geocoder = new MapboxGeocoder({ // Initialize the geocoder
          accessToken: mapboxgl.accessToken, // Set the access token
          mapboxgl: mapboxgl, // Set the mapbox-gl instance
          marker: false, // Do not use the default marker style
          placeholder: 'Search in Melbourne', // Placeholder text for the search bar
          bbox: [140.6, -39.3, 150.3, -33.8], // Boundary for Berkeley
          proximity: {
            longitude: 144.946457,
            latitude: -37.840935
          } // Coordinates of Melbourne
        });
        map.addControl(geocoder);

        //zoom in and out function
        map.addControl(new mapboxgl.NavigationControl());

        // locate yourself.
        map.addControl(
            new mapboxgl.GeolocateControl({
            positionOptions: {
            enableHighAccuracy: true
            },
            trackUserLocation: true
            })
        );;

        //direction
        map.addControl(
        new MapboxDirections({
        accessToken: mapboxgl.accessToken
        }),
        'top-left'
        );
    </script>